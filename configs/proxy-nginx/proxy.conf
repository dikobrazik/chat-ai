server {
  listen 80;
  # Замените 'your_domain.com' на ваш домен
  server_name 5.187.0.57; 
  
  # DNS-серверы для разрешения имен upstream-серверов
  resolver 8.8.8.8 8.8.4.4; 

  # ------------------------------------------------------------------
  # 1. Проксирование на OpenAI API через /openai
  # ------------------------------------------------------------------
  location /openai {
      # Удаляем префикс /openai перед отправкой запроса
      rewrite ^/openai(/.*)$ $1 break; 
      
      # Используем имя upstream-блока
      proxy_pass https://api.openai.com$uri$is_args$args; 

      proxy_set_header Host api.openai.com;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      
      # SSL/TLS настройки для исходящих запросов
      proxy_ssl_server_name on;
      proxy_ssl_protocols TLSv1.2 TLSv1.3;
      proxy_ssl_ciphers HIGH:!aNULL:!MD5;

      # Таймауты
      proxy_connect_timeout 60s;
      proxy_send_timeout 60s;
      proxy_read_timeout 60s; 
  }

  # ------------------------------------------------------------------
  # 2. Проксирование на Google через /google
  # ------------------------------------------------------------------
  location /google {
      # Удаляем префикс /google
      rewrite ^/google(/.*)$ $1 break;

      # Используем имя upstream-блока
      proxy_pass https://generativelanguage.googleapis.com$uri$is_args$args;

      proxy_set_header Host generativelanguage.googleapis.com;
      proxy_set_header X-Real-IP $remote_addr;
      proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
      proxy_set_header X-Forwarded-Proto $scheme;
      
      # SSL/TLS настройки для исходящих запросов
      proxy_ssl_server_name on;
      proxy_ssl_protocols TLSv1.2 TLSv1.3;
      proxy_ssl_ciphers HIGH:!aNULL:!MD5;

      # Таймауты
      proxy_connect_timeout 60s;
      proxy_send_timeout 60s;
      proxy_read_timeout 60s; 
  }
}